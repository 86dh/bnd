---
title: Bndtools Concepts
description: Introduction to the Basics
author: Neil Bartlett
---

% Bndtools Concepts
% Neil Bartlett
% 23 December 2011

**WARNING this document is a work-in-progress and several sections may be incomplete or inaccurate!**

Repositories
============

Bndtools uses *repositories* to supply dependencies to be used at build-time and at runtime. A repository is just a collection of bundles. It may be located anywhere: in the workspace; somewhere else on the local file system; or on a remote server.

Bndtools uses repositories in the following ways:

* To look up bundles specified on the Build Path by Bundle Symbolic Name (BSN) and version;
* To resolve the Run Requirements list;
* To look up bundles specified in the Run Bundles list by BSN and version.

Repositories are implemented as bnd plug-ins, and can be configured by editing the Plugins sections of the workspace configuration file (*Bndtools* menu Â» *Open main bnd config*).

![](/images/concepts/repositories01.png)

Since repositories are implemented as plug-ins, it is theoretically possible to support almost any kind of repository, by developing a new plug-in type; though of course it is more convenient to use an existing repository plug-in. Bnd and Bndtools support the following repository types out-of-the-box.

## OBR Repository ##

This type of repository is based on the [OSGi Bundle Repository](http://www.osgi.org/Repository/BIndex) pseudo-standard. The repository contents are defined by the contents of an index file -- usually named `repository.xml` -- as generated by the Bindex tool. The index may be either local or remote, and the resource referenced by the index may also be either local or remote. In the case of remote index and/or resources, a local cache is used to avoid repeated downloads and to enable offline builds.

This type of repository is not editable from within Bndtools. Modifying the content of the repository would require running the Bindex tool to regenerate the index file.

The following properties are supported:

------------------------------------------------------------------------------------------------------
Name        Description                                   Required?
----------- --------------------------------------------  --------------------------------------------
`name`      Name for the repository.                      No.

`mode`      Resolution mode: `build`, `runtime` or `any`. No. Default: `any`
            Controls the resolution phase in which this
            repository may be used.

`locations` Comma-separated list of index URLs.           No. Default: empty
            **NB:** surround this value with
            single-quotes if it contains more than one
            entry.

`cache`     Local cache directory for remote              No. Default: `cnf/cache/.obr/`
            resources.
------------------------------------------------------------------------------------------------------

## Local OBR Repository ##

This type of repository is also based on OBR but it maintains a local filesystem directory of bundles. It is editable from within Bndtools and the OBR index is updated automatically when bundles are deployed into it.

The following properties are supported:

------------------------------------------------------------------------------------------------------
Name        Description                                   Required?
----------- --------------------------------------------  --------------------------------------------
`name`      Name for the repository.                      No.

`local`     The local filesystem directory.               Yes.

`readonly`  Whether the repository should be read-only,   No. Default: false
            i.e. disabled for editing from Bndtools.

`mode`      Resolution mode: `build`, `runtime` or `any`. No. Default: `any`
            Controls the resolution phase in which this
            repository may be used.

`locations` Comma-separated list of *additional* index    No. Default: empty
            URLs. **NB:** surround this value with
            single-quotes if it contains more than one
            entry.

`cache`     Local cache directory for remote              No. Default: `${local}/.obrcache`
            resources.
------------------------------------------------------------------------------------------------------

## File Repository ##

This type of repository is based on a very simple file system directory structure. It is editable from within Bndtools. **NB:** it does not support OBR indexes, so repositories of this type cannot participate in OBR resolution of Run Configurations.

The following properties are supported:

------------------------------------------------------------------------------------------------------
Name        Description                                   Required?
----------- --------------------------------------------  --------------------------------------------
`name`      Name for the repository.                      No.

`location`  The local filesystem directory.               Yes.

`readonly`  Whether the repository should be read-only,   No. Default: false
            i.e. disabled for editing from Bndtools.
------------------------------------------------------------------------------------------------------

## Maven Local Repository ##

This type of repository is used to access bundles in the Maven local repository, usually found in `$HOME/.m2/repository`. Note that this plug-in accesses the Maven repository directly and does not building with Maven.

------------------------------------------------------------------------------------------------------
Name        Description                                   Required?
----------- --------------------------------------------  --------------------------------------------
`name`      Name for the repository.                      No.

`root`      The location of the Maven repository.         No. Default: `$HOME/.m2/repository`
------------------------------------------------------------------------------------------------------

Note that if you use the [Bundle Plugin for Maven](http://felix.apache.org/site/apache-felix-maven-bundle-plugin-bnd.html) then you can also use the [OBR](#obr-repository) repository type, since the Bundle Plugin generates an OBR index file whenever `maven install` is executed. For example:

    aQute.bnd.deployer.repository.FixedIndexedRepo;locations='file:${user.home}/.m2/repository/repository.xml';name='Maven Repo'


## Maven Remote Repository ##

This type of repository can be used to access bundles in a remote Maven repository, including Maven Central or any Nexus repository. **NB:** this repository type is not browseable; if you attempt to view the contents of the repository using the Repositories View in Bndtools, it will appear to be empty. However it will be possible to reference JARs from the repository in your `-buildpath` or `-runbundles` if the group ID and artefact ID is known.

For example to reference a JAR with group ID `org.osgi` and artefact ID `osgi_R4_core`, use the following syntax:

	-buildpath: org.osgi+osgi_R4_core

------------------------------------------------------------------------------------------------------
Name            Description                                      Required?
--------------- -----------------------------------------------  -------------------------------------
`repositories`  Comma-separated list of Maven repository URLs.   No. Default: empty 
                **NB:** surround this value with
                single-quotes if it contains more than one
                entry.
------------------------------------------------------------------------------------------------------

Plug-ins and Plug-in Paths
==========================

Repositories and other kinds of plug-in can be added to the workspace by editing the `-plugin` entry in `cnf/build.bnd`. Plug-ins are specified by their class name, with additional configuration properties passed as follows:

    -plugin: <classname>;<property>=<value>;<property>=<value>,\
             <classname>;<property>=<value>;<property>=<value>

For example:

    -plugin: org.example.Plugin1;name=First;location=http://www.example.com/,\
             org.example.Plugin2;name=Second;licence=ApacheV2

Note that if a property value contains a comma then the whole value must be enclosed in single or double quotes, to prevent the comma being interpreted as a delimiter in the plug-in list.

If the plug-in class is not built into bnd/Bndtools then we must use the `path:` directive to specify the classpath for the plug-in, e.g.:

    -plugin: org.example.MyPlugin;path:="cnf/plugins/myplugin-1.0.jar,/usr/local/lib/foo.jar"

Bundles and Bnd Files
=====================

Bndtools follows the "generated manifest" approach to building OSGi bundles; this is in contrast to the "manifest first" approach used by some other tools. See the OSGi Community Wiki page on [Tooling Approaches](http://wiki.osgi.org/wiki/Tooling_Approaches) for an explanation of the difference between these approaches.

Bndtools projects are based on standard Eclipse Java projects. After the Java code is compiled into classfiles, the Bndtools builder takes over and produces one or more OSGi bundles. It uses `.bnd` files to control the contents of the OSGi bundles that it generates.

The Project Settings File: bnd.bnd
----------------------------------

A Bndtools project always contains a file named `bnd.bnd`. This file contains project settings such as the Build Path, which defines the libraries that are visible to the project at build time:

![](/images/concepts/bundles01.png)

Single-Bundle and Multiple-Bundle Projects
------------------------------------------

Bndtools projects either generate a single bundle or multiple bundles. In the single-bundle mode (which is the default) all the instructions defining that bundle are listed in the `bnd.bnd` file: in other words, the `bnd.bnd` file controls both the project settings *and* the instructions for generating a single bundle.

In the multiple-bundle mode, the `bnd.bnd` still contains project settings such as Build Path. However the instructions controlling the output of bundles is separated into several other `.bnd` files. These are known as "sub-bundles", and turning on multiple-bundles mode is known as enabling "sub-bundles":

![](/images/concepts/bundles02.png)

When sub-bundles mode is turned on, one bundle is generated for *each* other `.bnd` file in the top-level of the Bndtools project. Those `.bnd` files contain only the instructions required to define the contents of a bundle such as Private Packages, Export Packages, etc.

Derived Bundle Symbolic Names
-----------------------------

The bundle symbolic name (BSN) of a generated bundle is derived from the project name and -- if sub-bundles is enabled -- the name of the sub-bundle file.

In single-bundle mode, the BSN of the bundle will be equal to the name of the Bndtools project. So if the project name is `org.example` then the BSN of the bundle will be `org.example`:

	Bundle-SymbolicName: org.example

In sub-bundles mode, the BSN of each bundle is equal the name of the project plus the name of the sub-bundle file excluding its `.bnd` extension. So if the project name is `org.example` and there is a sub-bundle file named `foo.bnd` the BSN will be `org.example.foo`:

	Bundle-SymbolicName: org.example.foo

You should not attempt to override the generated BSN, e.g. by including a `Bundle-SymbolicName` head in the `.bnd` file, because Bndtools uses the association between project names and bundle names in order to find bundles when projects depend on them.

