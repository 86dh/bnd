<!DOCTYPE html>
<html lang="en" ng-app="jpm">

	<head>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="/releases/6.2.0/css/style.css" rel="stylesheet" />
<script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
<script src="/js/releases.js"></script>
<!-- Begin Jekyll SEO tag v2.7.1 -->
<title>AspectJ Plugin | bnd</title>
<meta name="generator" content="Jekyll v3.9.0" />
<meta property="og:title" content="AspectJ Plugin" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Aspects make it possible to centralize cross cutting concerns." />
<meta property="og:description" content="Aspects make it possible to centralize cross cutting concerns." />
<meta property="og:site_name" content="bnd" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="AspectJ Plugin" />
<script type="application/ld+json">
{"url":"/releases/6.2.0/plugins/aspectj.html","headline":"AspectJ Plugin","description":"Aspects make it possible to centralize cross cutting concerns.","@type":"WebPage","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->


	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

</head>


<body>

	
<ul class="container12 menu-bar">
	<li span=11><a class=menu-link href="/releases/6.2.0/"><img
			class=menu-logo src="/releases/6.2.0/img/bnd-80x40-white.png"></a>
			<a href="/releases/6.2.0/chapters/110-introduction.html">Intro
			</a><a href="/releases/6.2.0/chapters/800-headers.html">Headers
			</a><a href="/releases/6.2.0/chapters/825-instructions-ref.html">Instructions
			</a><a href="/releases/6.2.0/chapters/855-macros-ref.html">Macros
			</a><a href="/releases/6.2.0/chapters/400-commands.html">Commands
			</a><div class="releases"><button class="dropbtn">6.2.0</button><div class="dropdown-content"></div></div>
	<li class=menu-link span=1>
			<a href="https://github.com/bndtools/bnd" target="_"><img
	style="position:absolute;top:0;right:0;margin:0;padding:0;z-index:100"
	src="https://camo.githubusercontent.com/38ef81f8aca64bb9a64448d0d70f1308ef5341ab/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f6461726b626c75655f3132313632312e706e67"
	alt="Fork me on GitHub"
	data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png"></a>
</ul>


					

	<ul class=container12>
		<li span=3>
			<div>
			<ul class="side-nav">
	
		
			<li><a href="/releases/6.2.0/chapters/110-introduction.html">Introduction</a>
	  	
  	
		
			<li><a href="/releases/6.2.0/chapters/120-install.html">How to install bnd</a>
	  	
  	
		
			<li><a href="/releases/6.2.0/chapters/123-tour-workspace.html">Guided Tour</a>
	  	
  	
		
			<li><a href="/releases/6.2.0/chapters/125-tour-features.html">Guided Tour Workspace & Projects</a>
	  	
  	
		
			<li><a href="/releases/6.2.0/chapters/130-concepts.html">Concepts</a>
	  	
  	
		
			<li><a href="/releases/6.2.0/chapters/140-best-practices.html">Best practices</a>
	  	
  	
		
			<li><a href="/releases/6.2.0/chapters/150-build.html">Build</a>
	  	
  	
		
			<li><a href="/releases/6.2.0/chapters/155-project-setup.html">Project Setup</a>
	  	
  	
		
			<li><a href="/releases/6.2.0/chapters/160-jars.html">Generating JARs</a>
	  	
  	
		
			<li><a href="/releases/6.2.0/chapters/170-versioning.html">Versioning</a>
	  	
  	
		
			<li><a href="/releases/6.2.0/chapters/180-baselining.html">Baselining</a>
	  	
  	
		
			<li><a href="/releases/6.2.0/chapters/200-components.html">Service Components</a>
	  	
  	
		
			<li><a href="/releases/6.2.0/chapters/210-metatype.html">Metatype</a>
	  	
  	
		
			<li><a href="/releases/6.2.0/chapters/220-contracts.html">Contracts</a>
	  	
  	
		
			<li><a href="/releases/6.2.0/chapters/230-manifest-annotations.html">Bundle Annotations</a>
	  	
  	
		
			<li><a href="/releases/6.2.0/chapters/235-accessor-properties.html">Accessor Properties</a>
	  	
  	
		
			<li><a href="/releases/6.2.0/chapters/240-spi-annotations.html">SPI Annotations</a>
	  	
  	
		
			<li><a href="/releases/6.2.0/chapters/250-resolving.html">Resolving Dependencies</a>
	  	
  	
		
			<li><a href="/releases/6.2.0/chapters/300-launching.html">Launching</a>
	  	
  	
		
			<li><a href="/releases/6.2.0/chapters/305-startlevels.html">Startlevels</a>
	  	
  	
		
			<li><a href="/releases/6.2.0/chapters/310-testing.html">Testing</a>
	  	
  	
		
			<li><a href="/releases/6.2.0/chapters/315-launchpad-testing.html">Testing with Launchpad</a>
	  	
  	
		
			<li><a href="/releases/6.2.0/chapters/320-packaging.html">Packaging Applications</a>
	  	
  	
		
			<li><a href="/releases/6.2.0/chapters/330-jpms.html">JPMS Libraries</a>
	  	
  	
		
			<li><a href="/releases/6.2.0/chapters/390-wrapping.html">Wrapping Libraries to OSGi Bundles</a>
	  	
  	
		
			<li><a href="/releases/6.2.0/chapters/395-generating-documentation.html">Generating Documentation</a>
	  	
  	
		
			<li><a href="/releases/6.2.0/chapters/400-commands.html">Commands</a>
	  	
  	
		
			<li><a href="/releases/6.2.0/chapters/600-developer.html">For Developers</a>
	  	
  	
		
			<li><a href="/releases/6.2.0/chapters/650-windows.html">Tips for Windows users</a>
	  	
  	
		
			<li><a href="/releases/6.2.0/chapters/700-tools.html">Tools bound to bnd</a>
	  	
  	
		
			<li><a href="/releases/6.2.0/chapters/800-headers.html">Headers</a>
	  	
  	
		
			<li><a href="/releases/6.2.0/chapters/820-instructions.html">Instruction Reference</a>
	  	
  	
		
			<li><a href="/releases/6.2.0/chapters/825-instructions-ref.html">Instruction Index</a>
	  	
  	
		
			<li><a href="/releases/6.2.0/chapters/850-macros.html">Macro Reference</a>
	  	
  	
		
			<li><a href="/releases/6.2.0/chapters/855-macros-ref.html">Macro Index</a>
	  	
  	
		
			<li><a href="/releases/6.2.0/chapters/870-plugins.html">Plugins</a>
	  	
  	
		
			<li><a href="/releases/6.2.0/chapters/875-external-plugins.html">External Plugins</a>
	  	
  	
		
			<li><a href="/releases/6.2.0/chapters/880-settings.html">Settings</a>
	  	
  	
		
			<li><a href="/releases/6.2.0/chapters/900-errors.html">Errors</a>
	  	
  	
		
			<li><a href="/releases/6.2.0/chapters/910-warnings.html">Warnings</a>
	  	
  	
		
			<li><a href="/releases/6.2.0/chapters/920-faq.html">Frequently Asked Questions</a>
	  	
  	
</ul>

			</div>
			
		<li span=9>
			<div class=notes-margin>
				<h1> AspectJ Plugin</h1>
				<p>Aspects make it possible to centralize <em>cross cutting concerns</em>.</p>

<p>The biz.aQute.aspectj.plugin.AspectJ plugin allows you to weave an executable JAR during export. It
provides a new export type:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>bnd.executablejar.aspectj
</code></pre></div></div>

<p>This export will use the bnd default export type to create an executable JAR. It will then weave
all the bundles inside this executable jar according to some <em>aspect bundles</em>. An aspect bundle
is created with either the <a href="https://www.eclipse.org/aspectj/doc/released/devguide/ajc-ref.html">ajc compiler</a> or uses the annotations based definition of AspectJ code.</p>

<p>Any aspect bundles are compiled to convert the annotations to actual code and added to the
dependencies.</p>

<p>The export function has the following arguments:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">match</code> – A globbing expression on the bundle names to weave. The expression matches if the glob can be 
<em>found</em>. I.e. it is not necessary to full match since it is applied to the path inside the bundle. The default
is all bundles (*).</li>
  <li><code class="language-plaintext highlighter-rouge">aspectpath</code> – List of bundle symbolic names of aspect bundles that need to be applied</li>
  <li><code class="language-plaintext highlighter-rouge">ajc</code> – A comma separated list of ajc options</li>
</ul>

<p>The ajc is invoked with the same <code class="language-plaintext highlighter-rouge">javac</code> source and target as defined in the workspace.</p>

<h2 id="example">Example</h2>

<p>To enable the AspectJ plugin, add a plugin in the worksapce <code class="language-plaintext highlighter-rouge">build.bnd</code> file. (There is a context
menu entry for this.)</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>-plugins \
    ...., \
    aQute.bnd.aspectj.plugin.AspectJ
</code></pre></div></div>

<p>The following code defines an aspect with the annotation model in a bundle called ‘aspect’:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
    @Aspect
    public class AspectHandler {
        @Before("execution(void *.start(org.osgi.framework.BundleContext))")
        public void myadvice(JoinPoint jp) {
            BundleContext c = (BundleContext) jp.getArgs()[0];
            System.out.println("Starting bundle : " + c.getBundle());
        }
    }
</code></pre></div></div>
<p>The cutpoint will print out a message on each invocation of a Bundle Activator start method.</p>

<p>To test this create a <code class="language-plaintext highlighter-rouge">test.bndrun</code> in an export project:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>-runfw: org.apache.felix.framework;version='[6.0.2,6.0.2]'
-runee: JavaSE-1.8
-runrequires: \
    bnd.identity;id='exporter',\
    bnd.identity;id='org.apache.felix.gogo.command',\
    bnd.identity;id='org.apache.felix.gogo.runtime',\
    bnd.identity;id='org.apache.felix.gogo.shell'
</code></pre></div></div>
<p>You can then resolve it and run it to see if the shell works.</p>

<p>Next is to export the <code class="language-plaintext highlighter-rouge">test.bndrun</code> in the <code class="language-plaintext highlighter-rouge">bnd.bnd</code> file of a project:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>-export \
    test.bndrun; \
        type            = bnd.executablejar.aspectj; \
        match           = *; \
        aspectpath      = aspect
</code></pre></div></div>
<p>This will export the the executable JAR while it applies the bundle <code class="language-plaintext highlighter-rouge">aspect</code> to all bundles.</p>

<h2 id="limitations">Limitations</h2>

<p>The Aspectj compiler is trying hard to crush the fences of modularity. Currently the bundles are woven one by one, which means 
some dependencies are not visible to them. The plugin needs some experience and feedback to grow. However, it already seems
quite usable in its current incarnation.</p>

<p>One issue is the ‘compiling’ of the annotations that happens on the <code class="language-plaintext highlighter-rouge">-aspectpath</code>. This means that the ‘compiled’ (not
woven) aspects must be in the output. The rules are not always completely clear and we’re working on making this
work in all OSGi scenarios. Please provide feedback.</p>


			</div>
	</ul>

	
<nav class=next-prev>
	<a href='/releases/6.2.0/plugins/ant.html'></a> <a href='/releases/6.2.0/plugins/blueprint.html'></a>
</nav>
<footer class="container12" style="border-top: 1px solid black;padding:10px 0">
	<ul span=12 row>
		<li span=12>
			<ul>
				<li><a href="/releases/6.2.0/">GitHub</a>
			</ul>
	</ul>
</footer>

</body>
</html>
