<?xml version="1.0" encoding="UTF-8"?>
<?eclipse version="3.5"?>
<plugin>

	<extension point="org.eclipse.m2e.core.lifecycleMappingMetadataSource">
	</extension>

	<extension point="org.eclipse.m2e.core.projectConfigurators">
		<configurator
			class="bndtools.m2e.BndConfigurator"
			id="bndtools.m2e.bndconfigurator"
			name="Bndtools m2e Bnd Configurator">
		</configurator>
		<configurator
			class="bndtools.m2e.IndexConfigurator"
			id="bndtools.m2e.indexconfigurator"
			name="Bndtools m2e Bnd Indexer Configurator">
		</configurator>
	</extension>

	<extension point="org.eclipse.core.expressions.propertyTesters">
		<propertyTester id="bndtools.m2e.launchPropertyTester"
			namespace="bndtools.m2e"
			properties="isInBndMavenProject,isResolvableBndMavenProject,isTestableBndMavenProject"
			class="bndtools.m2e.LaunchPropertyTester"
			type="org.eclipse.jdt.core.IJavaElement"/>
	</extension>

	<!-- LAUNCH SHORTCUTS -->
	<extension
			point="org.eclipse.debug.ui.launchShortcuts">
		<shortcut
				label="Bnd OSGi Test Launcher (JUnit)"
				icon="icons/bricks_junit.png"
				class="bndtools.launch.JUnitShortcut"
				modes="run, debug"
				id="bndtools.launch.junitShortcut"
				path="bndtools.launch.core">
			<contextualLaunch>
				<enablement>
				<or>
					<with variable="selection">
						<count value="1"/>
						<iterate>
							<or>
								<!-- Java/Maven/Bnd Project -->
								<and>
									<test property="org.eclipse.jdt.launching.isContainer"/>
									<test property="org.eclipse.jdt.launching.hasProjectNature" args="org.eclipse.jdt.core.javanature"/>
									<test property="org.eclipse.jdt.launching.hasProjectNature" args="org.eclipse.m2e.core.maven2Nature"/>
									<test property="bndtools.m2e.isTestableBndMavenProject" forcePluginActivation="true" />
								</and>

								<!--  Java element (src-folder, package or JUnit class) -->
								<adapt type="org.eclipse.jdt.core.IJavaElement">
									<test property="bndtools.m2e.isTestableBndMavenProject" forcePluginActivation="true" />
									<test property="org.eclipse.jdt.junit.canLaunchAsJUnit" forcePluginActivation="true" />
									<or>
										<test property="org.eclipse.jdt.core.hasTypeOnClasspath" value="org.junit.Test" />
										<test property="org.eclipse.jdt.core.hasTypeOnClasspath" value="junit.framework.Test" />
									</or>
								</adapt>

								<!-- bnd.bnd or *.bndrun file -->
								<and>
									<test property="bndtools.m2e.isTestableBndMavenProject" forcePluginActivation="true" />
									<instanceof value="org.eclipse.core.resources.IResource" />
									<or>
										<test property="org.eclipse.core.resources.name" value="bnd.bnd" />
										<test property="org.eclipse.core.resources.extension" value="bndrun" />
									</or>
								</and>
							</or>
						</iterate>
					</with>
					<with variable="activeEditorId">
						<or>
							<equals value="bndtools.bndProjectEditor"/>
							<equals value="bndtools.bndRunEditor"/>
						</or>
					</with>
				</or>
				</enablement>
			</contextualLaunch>
			<description
				description="Debug a JUnit Test in an OSGi Framework"
				mode="debug">
			</description>
			<description
				description="Run an OSGi JUnit Test in an OSGi framework"
				mode="run">
			</description>
		</shortcut>

		<shortcut
				class="bndtools.launch.RunShortcut"
				icon="icons/bricks_run.png"
				id="bndtools.launch.runShortcut"
				label="Bnd OSGi Run Launcher"
				modes="run, debug"
				path="bndtools.launch.core">
			<contextualLaunch>
				<enablement>
				<or>
					<with variable="selection">
						<count value="1"/>
						<iterate>
							<or>
								<!-- Java/Maven/Bnd Project -->
								<and>
									<test property="org.eclipse.jdt.launching.isContainer"/>
									<test property="org.eclipse.jdt.launching.hasProjectNature" args="org.eclipse.jdt.core.javanature"/>
									<test property="org.eclipse.jdt.launching.hasProjectNature" args="org.eclipse.m2e.core.maven2Nature"/>
									<test property="bndtools.m2e.isResolvableBndMavenProject" forcePluginActivation="true" />
								</and>

								<!--  Java element (src-folder, package or class) -->
								<adapt type="org.eclipse.jdt.core.IJavaElement">
									<test property="bndtools.m2e.isResolvableBndMavenProject" forcePluginActivation="true" />
								</adapt>

								<!-- bnd.bnd or *.bndrun file -->
								<and>
									<test property="bndtools.m2e.isResolvableBndMavenProject" forcePluginActivation="true" />
									<instanceof value="org.eclipse.core.resources.IResource" />
									<or>
										<test property="org.eclipse.core.resources.name" value="bnd.bnd" />
										<test property="org.eclipse.core.resources.extension" value="bndrun" />
									</or>
								</and>
							</or>
						</iterate>
					</with>
					<with variable="activeEditorId">
						<or>
							<equals value="bndtools.bndProjectEditor"/>
							<equals value="bndtools.bndRunEditor"/>
						</or>
					</with>
				</or>
				</enablement>
			</contextualLaunch>
		</shortcut>
	</extension>
</plugin>