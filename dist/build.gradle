assert(project != rootProject)


distclean.doLast {
   file("bundles").deleteDir()
}

task dist {
  description   "Release project 'dist' and all projects it depends on, then index the release repository."
  group         "Release"
}

/* depend on all bnd projects in the workspace */
rootProject.subprojects.each {
  if (it.hasProperty("bnd_project")) {
    indexOBR.dependsOn += [":" + it.name + ":release"]
    indexR5.dependsOn  += [":" + it.name + ":release"]
  }
}

void removeLatestBundles() {
  fileTree("bundles").include("**/*-latest.jar").each {
    delete(it)
  }
}

indexOBR.doFirst {
  removeLatestBundles()
}
indexR5.doFirst {
  removeLatestBundles()
}


dist.dependsOn += [index]
